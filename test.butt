# define user functions
function before {
  echo "before test"
}
function after {
  echo "after test"
}

# start test
start "Example of complex butt test"

  # call user function
  before

  # some custom code before test
  echo "some code" \
    && echo "another code"

  # debug tested command
  debug echo -e "test$'\n'test1"

  # assert command output
  assert_equal $status 0
  assert_equal "${outlines[0]}" test
  assert_equal "${outlines[1]}" test1

  # debug second tested command
  debug 'echo "aaa bbb" | cut -d" " -f2'

  # assert command output
  assert_equal $status 0
  assert_equal $stdout bbb

  # debug second tested command (another way)
  out="$(echo "aaa bbb" | cut -d" " -f2)"

  assert_equal $? 0
  assert_equal $out bbb

  # call user function
  after

# end test
end

start "Example of simple test"
  before
  debug echo "test"
  assert_equal $status 0
  assert_equal "$stdout" test
  after
end

start "Example of failing test"
  before
  debug echo "test"
  assert_equal $status 0
  assert_equal "$stdout" fail
  after
end